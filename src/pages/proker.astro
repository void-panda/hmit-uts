---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { ProkerCard } from "@/components/ProkerCard";

// Get all proker sorted by status then date
const allProker = await getCollection("proker");
const sortedProker = allProker.sort((a, b) => {
    const statusOrder = { berjalan: 0, perencanaan: 1, selesai: 2 };
    return statusOrder[a.data.status] - statusOrder[b.data.status];
});

// Group by bidang
const byBidang = sortedProker.reduce(
    (acc, proker) => {
        const bidang = proker.data.bidang;
        if (!acc[bidang]) acc[bidang] = [];
        acc[bidang].push(proker);
        return acc;
    },
    {} as Record<string, typeof sortedProker>,
);
---

<BaseLayout
    title="Program Kerja - HMIT UTS"
    description="Daftar program kerja Himpunan Mahasiswa Informatika UTS"
>
    <!-- Header -->
    <section
        class="relative py-24 lg:py-32 overflow-hidden bg-black text-white"
    >
        <div
            class="absolute inset-0 -z-10 bg-[radial-gradient(circle_at_bottom_left,rgba(249,115,22,0.1),transparent)]"
        >
        </div>
        <div class="container relative text-center">
            <div
                class="inline-block rounded-full bg-primary/20 px-4 py-2 text-sm font-black text-primary uppercase tracking-widest mb-6 italic animate-in fade-in duration-700"
            >
                What We Do
            </div>
            <h1
                class="text-5xl font-black md:text-7xl lg:text-8xl tracking-tight leading-tight animate-in fade-in slide-in-from-bottom-4 duration-1000"
            >
                Program <span
                    class="bg-gradient-to-r from-primary to-orange-500 bg-clip-text text-transparent italic"
                    >Kerja</span
                >
            </h1>
            <p
                class="mx-auto mt-8 max-w-2xl text-xl text-zinc-400 font-medium animate-in fade-in slide-in-from-bottom-6 duration-1200"
            >
                Daftar inisiatif dan kegiatan strategis yang dirancang untuk
                memperkuat skill, jaringan, dan prestasi mahasiswa informatika.
            </p>

            <!-- Status Legend with Tangerine Style -->
            <div
                class="mt-16 inline-flex flex-wrap items-center justify-center gap-8 rounded-3xl border border-white/10 bg-white/5 px-8 py-4 backdrop-blur-md animate-in fade-in zoom-in-95 duration-1000 delay-500"
            >
                <div class="flex items-center gap-3">
                    <span
                        class="size-4 rounded-full bg-amber-500 shadow-[0_0_15px_rgba(245,158,11,0.5)]"
                    ></span>
                    <span
                        class="text-sm font-black uppercase tracking-widest opacity-80"
                        >Perencanaan</span
                    >
                </div>
                <div class="flex items-center gap-3">
                    <span
                        class="size-4 rounded-full bg-orange-500 shadow-[0_0_15px_rgba(249,115,22,0.5)] animate-pulse"
                    ></span>
                    <span
                        class="text-sm font-black uppercase tracking-widest opacity-80 text-primary"
                        >Berjalan</span
                    >
                </div>
                <div class="flex items-center gap-3">
                    <span
                        class="size-4 rounded-full bg-emerald-500 shadow-[0_0_15px_rgba(16,185,129,0.5)] text-primary"
                    ></span>
                    <span
                        class="text-sm font-black uppercase tracking-widest opacity-80"
                        >Selesai</span
                    >
                </div>
            </div>
        </div>
    </section>

    <!-- Proker Sections -->
    <div class="bg-background relative">
        {
            Object.entries(byBidang).map(([bidang, prokers], index) => (
                <section
                    class={`py-24 lg:py-32 ${index % 2 === 1 ? "bg-card/30" : ""}`}
                >
                    <div class="container">
                        <div class="flex items-center gap-4 mb-16">
                            <h2 class="text-3xl lg:text-5xl font-black italic uppercase tracking-tighter">
                                {bidang}
                            </h2>
                            <div class="h-1 lg:h-2 flex-grow bg-primary/20 rounded-full">
                                <div class="h-full w-24 bg-primary rounded-full" />
                            </div>
                        </div>

                        <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
                            {prokers.map((proker) => (
                                <ProkerCard
                                    nama={proker.data.nama}
                                    bidang={proker.data.bidang}
                                    deskripsi={proker.data.deskripsi}
                                    status={proker.data.status}
                                    client:load
                                />
                            ))}
                        </div>
                    </div>
                </section>
            ))
        }
    </div>
</BaseLayout>
